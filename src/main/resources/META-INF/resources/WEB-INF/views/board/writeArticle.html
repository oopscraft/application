<!DOCTYPE html>
<html layout:decorate="~{index.html}">
<div layout:fragment="content">
	<script>
	// defines variables
	const article = new duice.Map();
	const articleFiles = new duice.List();
	
	// document ready
	$(document).ready(function() {
		if(duice.parseQueryString().id){
			getArticle();	
		}
	});
	
	/**
	 * Getting articles
	 */
	function getArticle(){
		$.ajax({
			 url: '[[@{/api/boards}]]/[[${board.id}]]/articles/[[${param.id}]]'
			,type: 'GET'
		})
		.done(function(data, textStatus, jqXHR) {
			article.fromJson(data);
			articleFiles.fromJson(data.files);
	   	});
	}
	
	/**
	 * Saves article reply
	 */
	async function saveArticle(){
		
		// checks title
		if(article.isEmpty('title')){
			duice.alert('[[#{application.global.enterItem(#{application.board.article.title})}]]');
			return false;
		}
		
		// executes save process
		if(await duice.confirm('[[#{application.global.saveConfirm(#{application.board.article})}]]')){
			var articleId = article.get('id');
			var url = '[[@{/api/boards}]]/[[${board.id}]]/articles';
			var type = 'POST';
			if(!duice.isEmpty(articleId)){
				url += '/' + articleId;
				type = 'PUT';
			}
			var data = article.toJson();
			data.files = articleFiles.toJson();
			$.ajax({
				 url: url
				,type: type
				,data: JSON.stringify(data)
				,contentType: 'application/json;charset=UTF-8'
			})
			.done(function(data, textStatus, jqXHR) {
				window.history.back();
		   	});
		}
	}
	
	</script>
	<th:block th:include="|../theme/application/board/default/writeArticle.html|"></th:block>
</div>



